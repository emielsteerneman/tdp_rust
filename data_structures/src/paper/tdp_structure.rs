use serde::Deserialize;

use super::Paragraph;

#[derive(Clone, Debug, Deserialize)]
pub struct TDPStructure {
    pub paragraphs: Vec<Paragraph>,
    // references
    // images
    // metadata
    // - authors
    // - title
    // - abstract
    // - keywords
    // - created at
    // - updated at
    // - version
    // - doi
}

impl TDPStructure {
    pub fn to_markdown(&self, title: &str, team_name: &str, year: u32, league: &str) -> String {
        let mut markdown = format!("# {}\n", title);
        markdown.push_str(&format!("**{} {} {}**\n\n", team_name, year, league));

        for paragraph in &self.paragraphs {
            let level = self.determine_level(&paragraph.title.raw);
            let hashes = "#".repeat(level);
            markdown.push_str(&format!("{} {}\n\n", hashes, paragraph.title.raw));

            let sentences: Vec<String> = paragraph
                .sentences
                .iter()
                .map(|s| s.raw.clone())
                .collect();
            markdown.push_str(&sentences.join(" "));
            markdown.push_str("\n\n");
        }

        markdown.trim().to_string()
    }

    fn determine_level(&self, title: &str) -> usize {
        let first_word = title.split_whitespace().next().unwrap_or("");

        // Check if first word is a numbering (e.g., "1", "1.1", "1.1.1", "1.", "1.1.")
        let is_numbering = first_word.chars().all(|c| c.is_ascii_digit() || c == '.');
        let has_digit = first_word.chars().any(|c| c.is_ascii_digit());

        if !is_numbering || !has_digit {
            return 2;
        }

        // Count dots, but ignore trailing dot for level calculation
        let clean_numbering = if first_word.ends_with('.') {
            &first_word[..first_word.len() - 1]
        } else {
            first_word
        };

        let dot_count = clean_numbering.chars().filter(|&c| c == '.').count();
        dot_count + 2
    }
}

#[cfg(test)]
mod tests {
    use crate::paper::TDPStructure;

    #[test]
    pub fn test_deserialize() {
        let json = r#"{"paragraphs": [{"sequence_id": 0, "title": {"sequence_id": 0, "paragraph_id": 0, "raw": "1 Introduction", "processed": "introduction"}, "sentences": [{"sequence_id": 0, "paragraph_id": 0, "raw": "The Carologistics RoboCup Team is a cooperation of the Knowledge-Based Systems Group (RWTH Aachen University) and the MASCOR Institute (FH Aachen University of Applied Sciences).", "processed": "carologistics robocup team cooperation knowledge based system group rwth aachen university mascor institute fh aachen university applied science"}, {"sequence_id": 1, "paragraph_id": 0, "raw": "The team was initiated in 2012.", "processed": "team initiated 2012"}, {"sequence_id": 2, "paragraph_id": 0, "raw": "Doctoral, master, and bachelor students of both partners participate in the project and bring in their specific strengths tackling the various aspects of the RoboCup Logistics League (RCLL): designing hardware modifications, developing functional software components, system integration, and high-level control of a group of mobile robots.", "processed": "doctoral master bachelor student partner participate project bring specific strength tackling various aspect robocup logistics league rcll designing hardware modification developing functional software component system integration high level control group mobile robot"}, {"sequence_id": 3, "paragraph_id": 0, "raw": "Our team has participated in RoboCup 20122017 and the RoboCup German Open (GO) 20132019.", "processed": "team participated robocup 20122017 robocup german open go 20132019"}, {"sequence_id": 4, "paragraph_id": 0, "raw": "We were able to win the GO 2014-2018 as well as the RoboCup 2014 thru 2017, demonstrating flexible task coordination, robust collision avoidance and self-localization through an easily maintainable and extensible framework architecture.", "processed": "able win go 2014 2018 well robocup 2014 thru 2017 demonstrating flexible task coordination robust collision avoidance self localization easily maintainable extensible framework architecture"}, {"sequence_id": 5, "paragraph_id": 0, "raw": "In the following we describe some of the challenges of the RCLL with a focus on the changes introduced in 2019.", "processed": "following describe challenge rcll focus change introduced 2019"}, {"sequence_id": 6, "paragraph_id": 0, "raw": "In Section 2 we give an overview of the hardware changes we are going to deploy in 2019.", "processed": "section give overview hardware change going deploy 2019"}, {"sequence_id": 7, "paragraph_id": 0, "raw": "We continue by describing updates to the functional software components in Section 3 and to behavior components in Section 4 before concluding in Section 5.", "processed": "continue describing update functional software component section behavior component section concluding section"}]}, {"sequence_id": 1, "title": {"sequence_id": 0, "paragraph_id": 1, "raw": "1.1 RoboCup Logistics League 2019", "processed": "robocup logistics league 2019"}, "sentences": [{"sequence_id": 0, "paragraph_id": 1, "raw": "As in previous years, the goal is to maintain and optimize the material flow in a simplified Smart Factory scenario.", "processed": "previous year goal maintain optimize material flow simplified smart factory scenario"}, {"sequence_id": 1, "paragraph_id": 1, "raw": "Two competing groups of up to three robots each use a set of exclusive machines spread over a common playing field to produce and deliver products (cf. [7,14,12]).", "processed": "two competing group three robot use set exclusive machine spread common playing field produce deliver product cf 14 12"}, {"sequence_id": 2, "paragraph_id": 1, "raw": "After the league switched from purely symbolic production to Festos physical Modular Production System (MPS) in 2015 [14], the rules and field layout have been incrementally refined to focus on challenges that are relevant to the Industry 4.0 movement [13].", "processed": "league switched purely symbolic production festos physical modular production system mp 2015 14 rule field layout incrementally refined focus challenge relevant industry movement 13"}, {"sequence_id": 3, "paragraph_id": 1, "raw": "For 2019, the biggest rule change is the introduction of competitive orders .", "processed": "2019 biggest rule change introduction competitive order"}, {"sequence_id": 4, "paragraph_id": 1, "raw": "For regular orders, each team can deliver the requested product and scores independently of the other team.", "processed": "regular order team deliver requested product score independently team"}, {"sequence_id": 5, "paragraph_id": 1, "raw": "For a competitive order, the team that delivers first gets bonus points, while the second team gets points deducted.", "processed": "competitive order team delivers first get bonus point second team get point deducted"}, {"sequence_id": 6, "paragraph_id": 1, "raw": "For this year, there will be only one competitive C 0 order during the regular game, which may be increased in the future.", "processed": "year one competitive order regular game may increased future"}, {"sequence_id": 7, "paragraph_id": 1, "raw": "On the technical side, the MPS stations will be equipped with barcode scanners, which will allow the tracking of workpieces, and thus to give points for (partial) production steps.", "processed": "technical side mp station equipped barcode scanner allow tracking workpiece thus give point partial production step"}]}, {"sequence_id": 2, "title": {"sequence_id": 0, "paragraph_id": 2, "raw": "2 The Carologistics Platform", "processed": "carologistics platform"}, "sentences": [{"sequence_id": 0, "paragraph_id": 2, "raw": "The standard robot platform of this league is the Robotino by Festo Didactic [5].", "processed": "standard robot platform league robotino festo didactic"}, {"sequence_id": 1, "paragraph_id": 2, "raw": "As in previous years, we are using the Robotino Version 3 with many hardware modifications and a custom software stack starting from the OS", "processed": "previous year using robotino version many hardware modification custom software stack starting o"}]}, {"sequence_id": 3, "title": {"sequence_id": 0, "paragraph_id": 3, "raw": "2.1 Gripper System", "processed": "gripper system"}, "sentences": [{"sequence_id": 0, "paragraph_id": 3, "raw": "The gripping system is an incremental update to the 3-axis system developed in 2018 [4].", "processed": "gripping system incremental update axis system developed 2018"}, {"sequence_id": 1, "paragraph_id": 3, "raw": "The assembly of the linear axes is mostly kept the same, except for some refinements to 3D-printed connective parts to save filament and increase stability.", "processed": "assembly linear ax mostly kept except refinement 3d printed connective part save filament increase stability"}, {"sequence_id": 2, "paragraph_id": 3, "raw": "The gripper itself has been redesigned to grip the workpiece from above with three instead of two fingers (cf.", "processed": "gripper redesigned grip workpiece three instead two finger cf"}, {"sequence_id": 3, "paragraph_id": 3, "raw": "Figure 1).", "processed": "figure"}, {"sequence_id": 4, "paragraph_id": 3, "raw": "The advantage we hope to gain from this is increased robustness and precision because the workpiece will always center between the three spring-loaded fingers, independently of the positioning error.", "processed": "advantage hope gain increased robustness precision workpiece always center three spring loaded finger independently positioning error"}, {"sequence_id": 5, "paragraph_id": 3, "raw": "Another advantage of the new design is that it retracts fully behind the robots circular base shape, which should significantly reduce the risk of damage and simplify path planning.", "processed": "another advantage new design retracts fully behind robot circular base shape significantly reduce risk damage simplify path planning"}]}, {"sequence_id": 4, "title": {"sequence_id": 0, "paragraph_id": 4, "raw": "2.2 Architecture and Middleware", "processed": "architecture middleware"}, "sentences": [{"sequence_id": 0, "paragraph_id": 4, "raw": "The software system of the Carologistics robots combines two different middlewares, Fawkes [8] and ROS [19].", "processed": "software system carologistics robot combine two different middlewares fawkes ro 19"}, {"sequence_id": 1, "paragraph_id": 4, "raw": "This allows us to use software components from both systems.", "processed": "allows u use software component system"}, {"sequence_id": 2, "paragraph_id": 4, "raw": "The overall system, however, is integrated using Fawkes.", "processed": "overall system however integrated using fawkes"}, {"sequence_id": 3, "paragraph_id": 4, "raw": "Adapter plugins connect the systems, for example to use ROS 3D visualization capabilities.", "processed": "adapter plugins connect system example use ro 3d visualization capability"}, {"sequence_id": 4, "paragraph_id": 4, "raw": "The overall software structure is inspired by the three-layer architecture paradigm [3].", "processed": "overall software structure inspired three layer architecture paradigm"}, {"sequence_id": 5, "paragraph_id": 4, "raw": "It consists of a deliberative layer for high-level reasoning, a reactive execution layer for breaking down high-level commands and monitoring their execution, and a feedback control layer for hardware access and functional components.", "processed": "consists deliberative layer high level reasoning reactive execution layer breaking high level command monitoring execution feedback control layer hardware access functional component"}, {"sequence_id": 6, "paragraph_id": 4, "raw": "Changes to the lowest layer are described in Section 3.", "processed": "change lowest layer described section"}, {"sequence_id": 7, "paragraph_id": 4, "raw": "The upper two layers are detailed in Section 4.", "processed": "upper two layer detailed section"}, {"sequence_id": 8, "paragraph_id": 4, "raw": "The communication between single components implemented as plugins is realized by a hybrid blackboard and messaging approach [8].", "processed": "communication single component implemented plugins realized hybrid blackboard messaging approach"}]}, {"sequence_id": 5, "title": {"sequence_id": 0, "paragraph_id": 5, "raw": "3 Advances to Functional Software Components", "processed": "advance functional software component"}, "sentences": [{"sequence_id": 0, "paragraph_id": 5, "raw": "A plethora of different software components is required for a multi-robot system.", "processed": "plethora different software component required multi robot system"}, {"sequence_id": 1, "paragraph_id": 5, "raw": "In this section, we focus on changes for this years competition, namely a new path planning module and a revised conveyor belt detection.", "processed": "section focus change year competition namely new path planning module revised conveyor belt detection"}]}, {"sequence_id": 6, "title": {"sequence_id": 0, "paragraph_id": 6, "raw": "3.1 Path Planning", "processed": "path planning"}, "sentences": [{"sequence_id": 0, "paragraph_id": 6, "raw": "Since our change to ROS move base in 2017, the whole navigation system has proven to be a flexible and reliable approach well-suited for the difficult navigation tasks in the RCLL.", "processed": "since change ro move base 2017 whole navigation system proven flexible reliable approach well suited difficult navigation task rcll"}, {"sequence_id": 1, "paragraph_id": 6, "raw": "and the actual goal.", "processed": "actual goal"}, {"sequence_id": 2, "paragraph_id": 6, "raw": "The actual goal of VFH is the current goal on the global path - Figure 2 shows an example histogram.", "processed": "actual goal vfh current goal global path figure show example histogram"}, {"sequence_id": 3, "paragraph_id": 6, "raw": "With the changes addressed in 2.1 we have even less motion constraints and can finally plan with a point-mass with respecto to the robot being a roundshaped platform with no mechanical parts pointing outwards while the robot is moving.", "processed": "change addressed even le motion constraint finally plan point mass respecto robot roundshaped platform mechanical part pointing outwards robot moving"}, {"sequence_id": 4, "paragraph_id": 6, "raw": "During our usage of the move base in general and particularly its very fixed behaviour defining a strict failure recovery procedure, we discovered that it makes sense to switch to a more flexible approach.", "processed": "usage move base general particularly fixed behaviour defining strict failure recovery procedure discovered make sense switch flexible approach"}, {"sequence_id": 5, "paragraph_id": 6, "raw": "Also, the changes for multiagent path planning introduced in 2018 were implemented around the move base without being a proper solution for multi-agent path planning.", "processed": "also change multiagent path planning introduced 2018 implemented around move base without proper solution multi agent path planning"}, {"sequence_id": 6, "paragraph_id": 6, "raw": "As such we decided to switch to ROS robot navigation locomotor 3 in general and in particular a fork of its locomove base implementing the multi-agent solution introduced last-year in a single clean solution.", "processed": "decided switch ro robot navigation locomotor general particular fork locomove base implementing multi agent solution introduced last year single clean solution"}, {"sequence_id": 7, "paragraph_id": 6, "raw": "We can now properly select what should happen when the globally planned path would actually cross the path of another robot, without having to give temporary goals to move base .", "processed": "properly select happen globally planned path would actually cross path another robot without give temporary goal move base"}]}, {"sequence_id": 7, "title": {"sequence_id": 0, "paragraph_id": 7, "raw": "3.2 Conveyor Belt Detection", "processed": "conveyor belt detection"}, "sentences": [{"sequence_id": 0, "paragraph_id": 7, "raw": "The conveyor belts are rather narrow compared to the products and thus require precise handling.", "processed": "conveyor belt rather narrow compared product thus require precise handling"}, {"sequence_id": 1, "paragraph_id": 7, "raw": "For reliable interaction, the error margin should be less than 3 mm.", "processed": "reliable interaction error margin le mm"}, {"sequence_id": 2, "paragraph_id": 7, "raw": "For 2019, we will re3 https://github.com/locusrobotics/robot_navigation fitting approach [17] since it is fast and much more robust against bad initial estimates, thus forming a three-stage pipeline: 1.", "processed": "2019 re3 http github com locusrobotics robot_navigation fitting approach 17 since fast much robust bad initial estimate thus forming three stage pipeline"}, {"sequence_id": 3, "paragraph_id": 7, "raw": "Laser-based line detection: Imprecise, but fast, robust and requires no initial estimate.", "processed": "laser based line detection imprecise fast robust requires initial estimate"}, {"sequence_id": 4, "paragraph_id": 7, "raw": "2.", "processed": ""}, {"sequence_id": 5, "paragraph_id": 7, "raw": "Plane fitting: Moderately precise, fast and robust against bad initial estimates.", "processed": "plane fitting moderately precise fast robust bad initial estimate"}, {"sequence_id": 6, "paragraph_id": 7, "raw": "3.", "processed": ""}, {"sequence_id": 7, "paragraph_id": 7, "raw": "ICP: Very precise, but slow and sensitive to bad initial estimates.", "processed": "icp precise slow sensitive bad initial estimate"}]}, {"sequence_id": 8, "title": {"sequence_id": 0, "paragraph_id": 8, "raw": "4 High-level Decision Making and Task Coordination", "processed": "high level decision making task coordination"}, "sentences": [{"sequence_id": 0, "paragraph_id": 8, "raw": "Vision AMCL Motion Components Actuator/Sensor proc.", "processed": "vision amcl motion component actuator sensor proc"}, {"sequence_id": 1, "paragraph_id": 8, "raw": "Localization, etc.", "processed": "localization etc"}, {"sequence_id": 2, "paragraph_id": 8, "raw": "Behavior Engine Reactive Behaviors Skill execution/monitoring CLIPS Agent Deliberation Decision making/planning Fig. 4.", "processed": "behavior engine reactive behavior skill execution monitoring clip agent deliberation decision making planning fig"}, {"sequence_id": 3, "paragraph_id": 8, "raw": "Behavior Layer Separation [12] The behavior generating components are separated into three layers, as depicted in Figure 4: the low-level processing for perception and actuation, a mid-level reactive layer, and a high-level reasoning layer.", "processed": "behavior layer separation 12 behavior generating component separated three layer depicted figure low level processing perception actuation mid level reactive layer high level reasoning layer"}, {"sequence_id": 4, "paragraph_id": 8, "raw": "The layers are combined following an adapted hybrid deliberative-reactive coordination paradigm.", "processed": "layer combined following adapted hybrid deliberative reactive coordination paradigm"}, {"sequence_id": 5, "paragraph_id": 8, "raw": "The robot group needs to cooperate on its tasks, that is, the robots communicate information about their current intentions, acquire exclusive control over resources such as locations or machines, and share their beliefs about the current state of the environment.", "processed": "robot group need cooperate task robot communicate information current intention acquire exclusive control resource location machine share belief current state environment"}, {"sequence_id": 6, "paragraph_id": 8, "raw": "In the following we describe the reactive and deliberative layers of the behavior components.", "processed": "following describe reactive deliberative layer behavior component"}, {"sequence_id": 7, "paragraph_id": 8, "raw": "For computational and energy efficiency, the behavior components need also to coordinate activation of the lower level components.", "processed": "computational energy efficiency behavior component need also coordinate activation lower level component"}]}, {"sequence_id": 9, "title": {"sequence_id": 0, "paragraph_id": 9, "raw": "4.1 Lua-based Behavior Engine", "processed": "lua based behavior engine"}, "sentences": [{"sequence_id": 0, "paragraph_id": 9, "raw": "In previous work we have developed the Lua-based Behavior Engine (BE) [9].", "processed": "previous work developed lua based behavior engine"}, {"sequence_id": 1, "paragraph_id": 9, "raw": "It serves as the reactive layer to interface between the low- and high-level systems.", "processed": "serf reactive layer interface low high level system"}, {"sequence_id": 2, "paragraph_id": 9, "raw": "The BE is based on hybrid state machines (HSM).", "processed": "based hybrid state machine hsm"}, {"sequence_id": 3, "paragraph_id": 9, "raw": "They can be depicted as a directed graph with nodes representing states for action execution, and/or monitoring of actuation, perception, and internal state.", "processed": "depicted directed graph node representing state action execution monitoring actuation perception internal state"}, {"sequence_id": 4, "paragraph_id": 9, "raw": "Edges denote jump conditions implemented as Boolean functions.", "processed": "edge denote jump condition implemented boolean function"}, {"sequence_id": 5, "paragraph_id": 9, "raw": "For the active state of a state machine, all outgoing conditions are evaluated, typically at about 15 Hz.", "processed": "active state state machine outgoing condition evaluated typically 15 hz"}, {"sequence_id": 6, "paragraph_id": 9, "raw": "If a condition fires, the active state is changed to the target node of the edge.", "processed": "condition fire active state changed target node edge"}, {"sequence_id": 7, "paragraph_id": 9, "raw": "A table of variables holds information like the world model, for example storing numeric values for object positions.", "processed": "table variable hold information like world model example storing numeric value object position"}, {"sequence_id": 8, "paragraph_id": 9, "raw": "It remedies typical problems of state machines like fast growing number of states or variable data passing from one state to another.", "processed": "remedy typical problem state machine like fast growing number state variable data passing one state another"}, {"sequence_id": 9, "paragraph_id": 9, "raw": "Skills are implemented using the light-weight, extensible scripting language Lua.", "processed": "skill implemented using light weight extensible scripting language lua"}]}, {"sequence_id": 10, "title": {"sequence_id": 0, "paragraph_id": 10, "raw": "4.2 Reasoning and Planning with the CLIPS Executive", "processed": "reasoning planning clip executive"}, "sentences": [{"sequence_id": 0, "paragraph_id": 10, "raw": "FORMULATED SELECTED EXPANDED COMMITTED DISPATCHED FINISHED EVALUATED RETRACTED Goal Reasoner Choose among goals Expander generates plan Commit to a plan or sub-goal Acquire goal resources Action selection and execution Evaluation of goal outcome CX/System Rejection Re-initiate monitoring (maintenance goal only) Fig. 5.", "processed": "formulated selected expanded committed dispatched finished evaluated retracted goal reasoner choose among goal expander generates plan commit plan sub goal acquire goal resource action selection execution evaluation goal outcome cx system rejection initiate monitoring maintenance goal fig"}, {"sequence_id": 1, "paragraph_id": 10, "raw": "The goal lifecycle with all possible goal modes [11].", "processed": "goal lifecycle possible goal mode 11"}, {"sequence_id": 2, "paragraph_id": 10, "raw": "We implemented an agent based on the CLIPS Executive (CX) [11], which uses a goal reasoning model [1].", "processed": "implemented agent based clip executive cx 11 us goal reasoning model"}, {"sequence_id": 3, "paragraph_id": 10, "raw": "A goal describes objectives that the agent should pursue and can either achieve or maintain a condition or state.", "processed": "goal describes objective agent pursue either achieve maintain condition state"}, {"sequence_id": 4, "paragraph_id": 10, "raw": "The program flow is determined by the goal mode , which describes the current progress of the goal.", "processed": "program flow determined goal mode describes current progress goal"}, {"sequence_id": 5, "paragraph_id": 10, "raw": "The mode transitions are determined by the goal lifecycle, which is depicted in Figure 5.", "processed": "mode transition determined goal lifecycle depicted figure"}, {"sequence_id": 6, "paragraph_id": 10, "raw": "When a goal is created, it is first formulated , merely meaning that it may be relevant to consider.", "processed": "goal created first formulated merely meaning may relevant consider"}, {"sequence_id": 7, "paragraph_id": 10, "raw": "The goal reasoner may decide to select a goal, which is then expanded into one or multiple plans, either by using manually specified plans or automatic planners such as PDDL planners [10].", "processed": "goal reasoner may decide select goal expanded one multiple plan either using manually specified plan automatic planner pddl planner 10"}, {"sequence_id": 8, "paragraph_id": 10, "raw": "The reasoner then commits to one of those plans, which is dispatched , typically by executing a skill of the behavior engine.", "processed": "reasoner commits one plan dispatched typically executing skill behavior engine"}, {"sequence_id": 9, "paragraph_id": 10, "raw": "Eventually, the goal is finished and the outcome is evaluated to determine the success of the goal.", "processed": "eventually goal finished outcome evaluated determine success goal"}, {"sequence_id": 10, "paragraph_id": 10, "raw": "The CX provides an explicit representation of the agents world model, and its goals, plans, and actions.", "processed": "cx provides explicit representation agent world model goal plan action"}, {"sequence_id": 11, "paragraph_id": 10, "raw": "It separates the domain model with the available operators, predicates, and known facts from the execution model , which enhances the domain model by features that are only relevant for the execution of the plan, e.g., exogenous actions and sensed predicates .", "processed": "separate domain model available operator predicate known fact execution model enhances domain model feature relevant execution plan exogenous action sensed predicate"}, {"sequence_id": 12, "paragraph_id": 10, "raw": "In contrast to the approaches described in [10,15], we currently do not use a planner, but instead use pre-defined plans.", "processed": "contrast approach described 10 15 currently use planner instead use pre defined plan"}]}, {"sequence_id": 11, "title": {"sequence_id": 0, "paragraph_id": 11, "raw": "4.3 Multi-Robot Coordination", "processed": "multi robot coordination"}, "sentences": [{"sequence_id": 0, "paragraph_id": 11, "raw": "The CX also provides means for multi-robot coordination, in particular world model synchronization , mutual exclusion , and resource allocation [11].", "processed": "cx also provides mean multi robot coordination particular world model synchronization mutual exclusion resource allocation 11"}, {"sequence_id": 1, "paragraph_id": 11, "raw": "To cooperate effectively, each agent must share (parts of) its world model with the other agents.", "processed": "cooperate effectively agent must share part world model agent"}, {"sequence_id": 2, "paragraph_id": 11, "raw": "The CX implements world model synchronization using a shared database [16,20].", "processed": "cx implement world model synchronization using shared database 16 20"}, {"sequence_id": 3, "paragraph_id": 11, "raw": "Each robot uses a database instance for local (agent-specific) and global (shared) world model facts.", "processed": "robot us database instance local agent specific global shared world model fact"}, {"sequence_id": 4, "paragraph_id": 11, "raw": "The global world model database is synchronized as part of a replica set with the global instances of the other robots.", "processed": "global world model database synchronized part replica set global instance robot"}, {"sequence_id": 5, "paragraph_id": 11, "raw": "Based on the replicated database, the CX also implements a locking mechanism.", "processed": "based replicated database cx also implement locking mechanism"}, {"sequence_id": 6, "paragraph_id": 11, "raw": "To lock a mutex, an agent must request a majority acknowledgement , thereby avoiding two agents to hold the same mutex.", "processed": "lock mutex agent must request majority acknowledgement thereby avoiding two agent hold mutex"}, {"sequence_id": 7, "paragraph_id": 11, "raw": "To allow mutual exclusion , the CX specifies two actions lock and unlock , which may be used by the agent just as any other action.", "processed": "allow mutual exclusion cx specifies two action lock unlock may used agent action"}, {"sequence_id": 8, "paragraph_id": 11, "raw": "Additionally, each goal may be associated with one or multiple resources that are required in order to dispatch the goal.", "processed": "additionally goal may associated one multiple resource required order dispatch goal"}, {"sequence_id": 9, "paragraph_id": 11, "raw": "If one resource is currently unavailable, the goal is rejected .", "processed": "one resource currently unavailable goal rejected"}, {"sequence_id": 10, "paragraph_id": 11, "raw": "Once a goal is retracted , its acquired resources are released automatically.", "processed": "goal retracted acquired resource released automatically"}]}, {"sequence_id": 12, "title": {"sequence_id": 0, "paragraph_id": 12, "raw": "5 Conclusion", "processed": "conclusion"}, "sentences": [{"sequence_id": 0, "paragraph_id": 12, "raw": "In 2019, we are continuing the development of an agent based on the CLIPS Executive, which provides an explicit goal representation including plans and actions with their preconditions and effects.", "processed": "2019 continuing development agent based clip executive provides explicit goal representation including plan action precondition effect"}, {"sequence_id": 1, "paragraph_id": 12, "raw": "Work on the mechanical side of the manipulator system is focused on a radical redesign of the gripper itself.", "processed": "work mechanical side manipulator system focused radical redesign gripper"}, {"sequence_id": 2, "paragraph_id": 12, "raw": "The conveyor detection pipeline is extended to combine the benefits and eliminate the downsides of all previous approaches.", "processed": "conveyor detection pipeline extended combine benefit eliminate downside previous approach"}, {"sequence_id": 3, "paragraph_id": 12, "raw": "For path planning, we switched from move base to robot navigation with a new implementation of multi-agent path planning.", "processed": "path planning switched move base robot navigation new implementation multi agent path planning"}, {"sequence_id": 4, "paragraph_id": 12, "raw": "The website of the Carologistics RoboCup Team with further information and media can be found at https://www.carologistics.org .", "processed": "website carologistics robocup team information medium found http www carologistics org"}, {"sequence_id": 5, "paragraph_id": 12, "raw": "Acknowledgements.", "processed": "acknowledgement"}, {"sequence_id": 6, "paragraph_id": 12, "raw": "We gratefully acknowledge the financial support of RWTH Aachen University and FH Aachen University of Applied Sciences.", "processed": "gratefully acknowledge financial support rwth aachen university fh aachen university applied science"}, {"sequence_id": 7, "paragraph_id": 12, "raw": "T.", "processed": ""}, {"sequence_id": 8, "paragraph_id": 12, "raw": "Hofmann and V.", "processed": "hofmann"}, {"sequence_id": 9, "paragraph_id": 12, "raw": "Matare were supported by the DFG grants GL-747/23-1 and FE-1077/4-1 (respectively) on Constraint-based Transformations of Abstract Task Plans into Executable Actions for Autonomous Robots 4 .", "processed": "matare supported dfg grant gl 747 23 fe 1077 respectively constraint based transformation abstract task plan executable action autonomous robot"}, {"sequence_id": 10, "paragraph_id": 12, "raw": "We appreciate the financial and organizational support by the Cybernetics Lab IMA & IfU, RWTH Aachen University.", "processed": "appreciate financial organizational support cybernetics lab ima ifu rwth aachen university"}, {"sequence_id": 11, "paragraph_id": 12, "raw": "We gratefully thank T.", "processed": "gratefully thank"}, {"sequence_id": 12, "paragraph_id": 12, "raw": "Niemueller for his continued support and contributions both to the league and to our team.", "processed": "niemueller continued support contribution league team"}, {"sequence_id": 13, "paragraph_id": 12, "raw": "References 1.", "processed": "reference"}, {"sequence_id": 14, "paragraph_id": 12, "raw": "Aha, D.W.: Goal Reasoning: Foundations, Emerging Applications, and Prospects.", "processed": "aha goal reasoning foundation emerging application prospect"}, {"sequence_id": 15, "paragraph_id": 12, "raw": "AI Magazine 39 (2) (Jul 2018) 2.", "processed": "ai magazine 39 jul 2018"}, {"sequence_id": 16, "paragraph_id": 12, "raw": "Borenstein, J., Koren, Y.: The vector field histogram-fast obstacle avoidance for mobile robots.", "processed": "borenstein koren vector field histogram fast obstacle avoidance mobile robot"}, {"sequence_id": 17, "paragraph_id": 12, "raw": "IEEE transactions on robotics and automation 7 (3), 278288 (1991) 3.", "processed": "ieee transaction robotics automation 278288 1991"}, {"sequence_id": 18, "paragraph_id": 12, "raw": "Gat, E.: Three-layer architectures.", "processed": "gat three layer architecture"}, {"sequence_id": 19, "paragraph_id": 12, "raw": "In: Kortenkamp, D., Bonasso, R.P., Murphy, R. (eds.) Artificial Intelligence and Mobile Robots, pp.", "processed": "kortenkamp bonasso murphy ed artificial intelligence mobile robot pp"}, {"sequence_id": 20, "paragraph_id": 12, "raw": "195210.", "processed": "195210"}, {"sequence_id": 21, "paragraph_id": 12, "raw": "MIT Press (1998) 4.", "processed": "mit press 1998"}, {"sequence_id": 22, "paragraph_id": 12, "raw": "Hofmann, T., Limpert, N., Matare, V., Schonitz, S., Niemueller, T., Ferrein, A., Lakemeyer, G.: The Carologistics RoboCup Logistics Team 2018.", "processed": "hofmann limpert matare schonitz niemueller ferrein lakemeyer carologistics robocup logistics team 2018"}, {"sequence_id": 23, "paragraph_id": 12, "raw": "Tech.", "processed": "tech"}, {"sequence_id": 24, "paragraph_id": 12, "raw": "rep., RWTH Aachen University and FH Aachen University of Applied Sciences (2018) 5.", "processed": "rep rwth aachen university fh aachen university applied science 2018"}, {"sequence_id": 25, "paragraph_id": 12, "raw": "Karras, U., Pensky, D., Rojas, O.: Mobile Robotics in Education and Research of Logistics.", "processed": "karras pensky rojas mobile robotics education research logistics"}, {"sequence_id": 26, "paragraph_id": 12, "raw": "In: IROS 2011 Workshop on Metrics and Methodologies for Autonomous Robot Teams in Logistics (2011) 6.", "processed": "iros 2011 workshop metric methodology autonomous robot team logistics 2011"}, {"sequence_id": 27, "paragraph_id": 12, "raw": "Neumann, T., Hofmann, T., Matare, V., Henke, C., Schonitz, S., Niemueller, T., Ferrein, A., Jeschke, S., Lakemeyer, G.: The Carologistics RoboCup Logistics Team 2017.", "processed": "neumann hofmann matare henke schonitz niemueller ferrein jeschke lakemeyer carologistics robocup logistics team 2017"}, {"sequence_id": 28, "paragraph_id": 12, "raw": "Tech.", "processed": "tech"}, {"sequence_id": 29, "paragraph_id": 12, "raw": "rep., RWTH Aachen University and FH Aachen University of Applied Sciences (2017) 4 http://gepris.dfg.de/gepris/projekt/288705857 7.", "processed": "rep rwth aachen university fh aachen university applied science 2017 http gepris dfg de gepris projekt 288705857"}, {"sequence_id": 30, "paragraph_id": 12, "raw": "Niemueller, T., Ewert, D., Reuter, S., Ferrein, A., Jeschke, S., Lakemeyer, G.: RoboCup Logistics League Sponsored by Festo: A Competitive Factory Automation Benchmark.", "processed": "niemueller ewert reuter ferrein jeschke lakemeyer robocup logistics league sponsored festo competitive factory automation benchmark"}, {"sequence_id": 31, "paragraph_id": 12, "raw": "In: RoboCup Symposium 2013 (2013) 8.", "processed": "robocup symposium 2013 2013"}, {"sequence_id": 32, "paragraph_id": 12, "raw": "Niemueller, T., Ferrein, A., Beck, D., Lakemeyer, G.: Design Principles of the Component-Based Robot Software Framework Fawkes.", "processed": "niemueller ferrein beck lakemeyer design principle component based robot software framework fawkes"}, {"sequence_id": 33, "paragraph_id": 12, "raw": "In: Int.", "processed": "int"}, {"sequence_id": 34, "paragraph_id": 12, "raw": "Conference on Simulation, Modeling, and Programming for Autonomous Robots (SIMPAR) (2010) 9.", "processed": "conference simulation modeling programming autonomous robot simpar 2010"}, {"sequence_id": 35, "paragraph_id": 12, "raw": "Niemueller, T., Ferrein, A., Lakemeyer, G.: A Lua-based Behavior Engine for Controlling the Humanoid Robot Nao.", "processed": "niemueller ferrein lakemeyer lua based behavior engine controlling humanoid robot nao"}, {"sequence_id": 36, "paragraph_id": 12, "raw": "In: RoboCup Symposium 2009 (2009) 10.", "processed": "robocup symposium 2009 2009 10"}, {"sequence_id": 37, "paragraph_id": 12, "raw": "Niemueller, T., Hofmann, T., Lakemeyer, G.: Clips-based execution for pddl planners.", "processed": "niemueller hofmann lakemeyer clip based execution pddl planner"}, {"sequence_id": 38, "paragraph_id": 12, "raw": "In: ICAPS Workshop on Integrated Planning, Acting and Execution (IntEx) (2018) 11.", "processed": "icaps workshop integrated planning acting execution intex 2018 11"}, {"sequence_id": 39, "paragraph_id": 12, "raw": "Niemueller, T., Hofmann, T., Lakemeyer, G.: Goal reasoning in the clips executive for integrated planning and execution.", "processed": "niemueller hofmann lakemeyer goal reasoning clip executive integrated planning execution"}, {"sequence_id": 40, "paragraph_id": 12, "raw": "In: Proceedings of the 29th International Conference on Planning and Scheduling (ICAPS) (2019) 12.", "processed": "proceeding 29th international conference planning scheduling icaps 2019 12"}, {"sequence_id": 41, "paragraph_id": 12, "raw": "Niemueller, T., Lakemeyer, G., Ferrein, A.: Incremental Task-level Reasoning in a Competitive Factory Automation Scenario.", "processed": "niemueller lakemeyer ferrein incremental task level reasoning competitive factory automation scenario"}, {"sequence_id": 42, "paragraph_id": 12, "raw": "In: Proc.", "processed": "proc"}, {"sequence_id": 43, "paragraph_id": 12, "raw": "of AAAI Spring Symposium 2013 - Designing Intelligent Robots: Reintegrating AI (2013) 13.", "processed": "aaai spring symposium 2013 designing intelligent robot reintegrating ai 2013 13"}, {"sequence_id": 44, "paragraph_id": 12, "raw": "Niemueller, T., Lakemeyer, G., Ferrein, A.: The robocup logistics league as a benchmark for planning in robotics.", "processed": "niemueller lakemeyer ferrein robocup logistics league benchmark planning robotics"}, {"sequence_id": 45, "paragraph_id": 12, "raw": "In: 25th International Conference on Automated Planning and Scheduling (ICAPS) Workshop on Planning in Robotics (2015) 14.", "processed": "25th international conference automated planning scheduling icaps workshop planning robotics 2015 14"}, {"sequence_id": 46, "paragraph_id": 12, "raw": "Niemueller, T., Lakemeyer, G., Ferrein, A., Reuter, S., Ewert, D., Jeschke, S., Pensky, D., Karras, U.: Proposal for Advancements to the LLSF in 2014 and beyond.", "processed": "niemueller lakemeyer ferrein reuter ewert jeschke pensky karras proposal advancement llsf 2014 beyond"}, {"sequence_id": 47, "paragraph_id": 12, "raw": "In: ICAR 1st Workshop on Developments in RoboCup Leagues (2013) 15.", "processed": "icar 1st workshop development robocup league 2013 15"}, {"sequence_id": 48, "paragraph_id": 12, "raw": "Niemueller, T., Lakemeyer, G., Leofante, F., Abraham, E.: Towards clips-based task execution and monitoring with SMT-based decision optimization.", "processed": "niemueller lakemeyer leofante abraham towards clip based task execution monitoring smt based decision optimization"}, {"sequence_id": 49, "paragraph_id": 12, "raw": "In: Workshop on Planning and Robotics (PlanRob) at International Conference on Automated Planning and Scheduling (ICAPS).", "processed": "workshop planning robotics planrob international conference automated planning scheduling icaps"}, {"sequence_id": 50, "paragraph_id": 12, "raw": "Pittsburgh, PA, USA (Jun 2017) 16.", "processed": "pittsburgh pa usa jun 2017 16"}, {"sequence_id": 51, "paragraph_id": 12, "raw": "Niemueller, T., Lakemeyer, G., Srinivasa, S.: A Generic Robot Database and its Application in Fault Analysis and Performance Evaluation.", "processed": "niemueller lakemeyer srinivasa generic robot database application fault analysis performance evaluation"}, {"sequence_id": 52, "paragraph_id": 12, "raw": "In: IEEE International Conference on Intelligent Robots and Systems (IROS) (2012).", "processed": "ieee international conference intelligent robot system iros 2012"}, {"sequence_id": 53, "paragraph_id": 12, "raw": "https://doi.org/10.1109/IROS.2012.6385940 17.", "processed": "http doi org 10 1109 iros 2012 6385940 17"}, {"sequence_id": 54, "paragraph_id": 12, "raw": "Niemueller, T., Neumann, T., Henke, C., Schonitz, S., Reuter, S., Ferrein, A., Jeschke, S., Lakemeyer, G.: Improvements for a Robust Production in the RoboCup Logistics League 2016.", "processed": "niemueller neumann henke schonitz reuter ferrein jeschke lakemeyer improvement robust production robocup logistics league 2016"}, {"sequence_id": 55, "paragraph_id": 12, "raw": "In: RoboCup Symposium Champion Teams Track (2016) 18.", "processed": "robocup symposium champion team track 2016 18"}, {"sequence_id": 56, "paragraph_id": 12, "raw": "Papazov, C., Burschka, D.: An efficient ransac for 3d object recognition in noisy and occluded scenes.", "processed": "papazov burschka efficient ransac 3d object recognition noisy occluded scene"}, {"sequence_id": 57, "paragraph_id": 12, "raw": "In: Asian Conference on Computer Vision.", "processed": "asian conference computer vision"}, {"sequence_id": 58, "paragraph_id": 12, "raw": "pp.", "processed": "pp"}, {"sequence_id": 59, "paragraph_id": 12, "raw": "135148.", "processed": "135148"}, {"sequence_id": 60, "paragraph_id": 12, "raw": "Springer (2010) 19.", "processed": "springer 2010 19"}, {"sequence_id": 61, "paragraph_id": 12, "raw": "Quigley, M., Conley, K., Gerkey, B.P., Faust, J., Foote, T., Leibs, J., Wheeler, R., Ng, A.Y.: ROS: an open-source Robot Operating System.", "processed": "quigley conley gerkey faust foote leibs wheeler ng ro open source robot operating system"}, {"sequence_id": 62, "paragraph_id": 12, "raw": "In: ICRA Workshop on Open Source Software (2009) 20.", "processed": "icra workshop open source software 2009 20"}, {"sequence_id": 63, "paragraph_id": 12, "raw": "Zwilling, F.: A Document-Oriented Robot Memory for Knowledge Sharing and Hybrid Reasoning on Mobile Robots.", "processed": "zwilling document oriented robot memory knowledge sharing hybrid reasoning mobile robot"}, {"sequence_id": 64, "paragraph_id": 12, "raw": "Masters thesis, RWTH Aachen University (2017)", "processed": "master thesis rwth aachen university 2017"}]}]}"#;

        let tdp_structure: TDPStructure = serde_json::from_str(json).unwrap();

        assert_eq!(tdp_structure.paragraphs.len(), 13);
    }

    #[test]
    pub fn test_to_markdown() {
        let json = r#"{"paragraphs": [
            {"title": {"raw": "1 Introduction", "processed": "introduction"}, "sentences": [{"raw": "Sentence 1.", "processed": "s1"}, {"raw": "Sentence 2.", "processed": "s2"}]},
            {"title": {"raw": "1.1 Sub", "processed": "sub"}, "sentences": [{"raw": "Sentence 3.", "processed": "s3"}]}
        ]}"#;

        let tdp_structure: TDPStructure = serde_json::from_str(json).unwrap();
        let markdown = tdp_structure.to_markdown("Test Title", "Team A", 2024, "League B");

        assert!(markdown.contains("# Test Title"));
        assert!(markdown.contains("**Team A 2024 League B**"));
        assert!(markdown.contains("## 1 Introduction"));
        assert!(markdown.contains("Sentence 1. Sentence 2."));
        assert!(markdown.contains("### 1.1 Sub"));
        assert!(markdown.contains("Sentence 3."));
    }
}
